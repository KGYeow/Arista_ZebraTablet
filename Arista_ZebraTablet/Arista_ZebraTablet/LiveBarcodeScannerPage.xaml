<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:Arista_ZebraTablet"
    xmlns:zxing="clr-namespace:ZXing.Net.Maui.Controls;assembly=ZXing.Net.MAUI.Controls"
    xmlns:zx="clr-namespace:ZXing.Net.Maui;assembly=ZXing.Net.MAUI"
    xmlns:components="clr-namespace:Arista_ZebraTablet.Components;assembly=Arista_ZebraTablet"
    xmlns:services="clr-namespace:Arista_ZebraTablet.Services;assembly=Arista_ZebraTablet"
    x:Class="Arista_ZebraTablet.LiveBarcodeScannerPage"
    Title="Scan Barcodes"
>
    <Grid RowDefinitions="0.6*,0.4*">
        <AbsoluteLayout Grid.Row="0">
            <!-- Scanning Camera -->
            <zxing:CameraBarcodeReaderView
                x:Name="CameraView"
                AbsoluteLayout.LayoutBounds="0,0,1,1"
                AbsoluteLayout.LayoutFlags="All"
                BarcodesDetected="OnBarcodesDetected"
                CameraLocation="Rear"
            >
                <zxing:CameraBarcodeReaderView.Options>
                    <zx:BarcodeReaderOptions AutoRotate="True" />
                </zxing:CameraBarcodeReaderView.Options>
            </zxing:CameraBarcodeReaderView>

            <!-- Scanning Paused Screen Overlay -->
            <Grid x:Name="PauseOverlay"
                AbsoluteLayout.LayoutBounds="0,0,1,1"
                AbsoluteLayout.LayoutFlags="All"
                IsVisible="False"
                BackgroundColor="#CC1F1F1F"
                InputTransparent="False"
                ZIndex="10"
            >

                <!-- Centered content -->
                <Grid RowDefinitions="Auto,Auto,Auto"
                    RowSpacing="14"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                >
                    <Label Grid.Row="1"
                       Text="Scanning paused"
                       TextColor="White"
                       FontSize="22"
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center" />
                </Grid>
            </Grid>

            <!-- Bottom Overlay Container that Fills the Camera Controls Area -->
            <Grid
                AbsoluteLayout.LayoutBounds="0,0,1,1"
                AbsoluteLayout.LayoutFlags="All"
                InputTransparent="False"
                BackgroundColor="Transparent"
                ZIndex="15"
            >
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Camera Controls Anchored at the Bottom -->
                <BlazorWebView x:Name="blazorWebViewCameraControls" Grid.Row="1" BackgroundColor="Transparent" HostPage="wwwroot/index.html">
                    <BlazorWebView.RootComponents>
                        <RootComponent Selector="#app" ComponentType="{x:Type components:BarcodeScannerControls}" />
                    </BlazorWebView.RootComponents>
                </BlazorWebView>
            </Grid>
        </AbsoluteLayout>

        <BlazorWebView x:Name="blazorWebViewScannedResult" Grid.Row="1" HostPage="wwwroot/index.html">
            <BlazorWebView.RootComponents>
                <!-- Results List -->
                <RootComponent Selector="#app" ComponentType="{x:Type components:BarcodeScannerResult}" />
            </BlazorWebView.RootComponents>
        </BlazorWebView>
    </Grid>
</ContentPage>