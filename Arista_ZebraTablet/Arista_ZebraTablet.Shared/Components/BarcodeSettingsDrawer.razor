@using Arista_ZebraTablet.Shared.Application.Enums
@using Arista_ZebraTablet.Shared.Application.ViewModels

<!-- Setting Button & Setting Options Drawer (Display on Smaller Screen) -->
<MudHidden Breakpoint="Breakpoint.SmAndUp">
    <!-- Setting Button -->
    <MudItem>
        <MudFab Color="Color.Primary"
                OnClick="ToggleSettingDrawer"
                Size="Size.Small"
                StartIcon="@Icons.Material.Rounded.MoreVert"
                DropShadow="false" />
    </MudItem>
</MudHidden>

    <!-- More Options Drawer -->
<MudDrawer @bind-Open="@moreSettingOpen" Anchor="@Anchor.Bottom" Elevation="25" Variant="@DrawerVariant.Temporary" Style="border-top-left-radius: 16px; border-top-right-radius: 16px; z-index: 20;">
    <MudSwipeArea @ref="@swipeArea" Class="w-100" OnSwipeMove="@HandleSwipeMove" OnSwipeEnd="@ResetSwipeArea" OnSwipeLeave="@OnSwipeLeave" PreventDefault>
        <MudNavMenu class="py-3" Color="Color.Info">
            <MudContainer Class="px-3 d-flex flex-column" Gutters="false">
                <MudList T="string" Color="Color.Inherit">
                    <MudListSubheader>
                        Barcode Classification
                    </MudListSubheader>
                    <MudListItem>
                        <MudToggleGroup T="BarcodeMode"
                                        @bind-Value="BarcodeMode"
                                        SelectionMode="SelectionMode.SingleSelection"
                                        SelectedClass="bg-white"
                                        Color="Color.Inherit"
                                        Size="Size.Small"
                                        Class="mud-theme-primary"
                                        Outlined="false">
                            <MudToggleItem Text="Standard" Value="BarcodeMode.Standard" Class="ma-1 rounded" />
                            <MudToggleItem Text="Unique" Value="BarcodeMode.Unique" Class="ma-1 rounded" />
                        </MudToggleGroup>
                    </MudListItem>
                </MudList>
            </MudContainer>
        </MudNavMenu>
    </MudSwipeArea>
</MudDrawer>

@code {
    [Parameter] public BarcodeMode BarcodeMode { get; set; }

    /// <summary>
    /// Tracks whether the "Setting" drawer is currently open.
    /// Bound to the MudDrawer component in the Home page.
    /// </summary>
    private bool moreSettingOpen { get; set; }

    /// <summary>
    /// Toggles the visibility of the "More Options" drawer.
    /// Called by the UI when the user clicks the floating action button.
    /// </summary>
    private void ToggleSettingDrawer() => moreSettingOpen = !moreSettingOpen;

    /// <summary>
    /// Reference to the MudSwipeArea component used for detecting swipe gestures
    /// on the "More Options" drawer.
    /// </summary>
    private MudSwipeArea swipeArea = null!;

    /// <summary>
    /// Handles swipe movement events from the MudSwipeArea.
    /// Closes the "More Options" drawer when a top-to-bottom swipe is detected.
    /// </summary>
    /// <param name="e">Event arguments containing swipe direction details.</param>
    public void HandleSwipeMove(MultiDimensionSwipeEventArgs e)
    {
        for (int i = 0; i < e.SwipeDirections.Count; i++)
        {
            if (e.SwipeDirections[i] == MudBlazor.SwipeDirection.TopToBottom && moreSettingOpen)
            {
                moreSettingOpen = false;
            }
        }
    }

    /// <summary>
    /// Called when the swipe gesture leaves the MudSwipeArea.
    /// Cancels any ongoing swipe and resets the UI state.
    /// </summary>
    private void OnSwipeLeave()
    {
        swipeArea.Cancel();
        ResetSwipeArea();
    }

    /// <summary>
    /// Requests a UI refresh after swipe-related state changes.
    /// </summary>
    private void ResetSwipeArea()
    {
        StateHasChanged();
    }
}
